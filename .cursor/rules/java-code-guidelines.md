# Java代码规范指南

## 1. 命名规范

### 1.1 包命名
- 包名全部小写，使用点号分隔
- 包名应该以公司域名反写开始，例如：`com.cursor.master`
- DDD相关包名规范：
  - 领域模型：`.domain.model`
  - 领域服务：`.domain.service`
  - 领域事件：`.domain.event`
  - 领域仓储：`.domain.repository`
  - 应用服务：`.application.service`
  - 应用命令：`.application.command`
  - 应用查询：`.application.query`
  - 基础设施：`.infrastructure`

### 1.2 类命名
- 使用大驼峰命名法（UpperCamelCase）
- 类名应该是名词或名词短语
- 测试类以Test结尾
- 抽象类以Abstract开头
- 异常类以Exception结尾
- 接口不应以I开头
- DDD相关类命名规范：
  - 实体类：直接使用领域名词
  - 值对象类：领域名词+属性
  - 聚合根类：直接使用核心领域名词
  - 领域服务类：领域名词+DomainService
  - 应用服务类：领域名词+ApplicationService
  - 命令类：动词+名词+Command
  - 查询类：名词+Query
  - 事件类：名词+动词过去式+Event
  - 仓储接口：领域名词+Repository
  - 仓储实现：领域名词+RepositoryImpl

### 1.3 方法命名
- 使用小驼峰命名法（lowerCamelCase）
- 方法名应该是动词或动词短语
- 测试方法可以包含下划线
- DDD相关方法命名规范：
  - 实体方法：表达业务行为的动词
  - 值对象方法：描述计算或转换
  - 领域服务方法：体现业务用例
  - 应用服务方法：体现用户意图
  - 仓储方法：save/find/update/delete等

### 1.4 变量命名
- 使用小驼峰命名法
- 常量使用大写字母，单词间用下划线分隔
- 不要使用单个字符命名，除非是临时变量
- DDD相关变量命名规范：
  - 实体ID：entityId
  - 值对象：使用完整的业务含义
  - 聚合根引用：使用领域名词
  - 仓储对象：repository后缀

## 2. 代码风格

### 2.1 缩进与空格
- 使用4个空格进行缩进，不使用Tab
- 运算符两侧使用空格
- 逗号后使用空格
- 左大括号不换行，右大括号独占一行

### 2.2 行长度
- 每行最多120个字符
- 超过限制时应该换行，换行后至少缩进8个空格

### 2.3 import语句
- 不使用通配符导入（import xxx.*）
- 按以下顺序分组并用空行分隔：
  1. java标准库导入
  2. 第三方库导入
  3. 本项目内导入

### 2.4 类成员顺序
1. 静态常量
2. 静态变量
3. 实例变量
4. 构造方法
5. 公共方法
6. 私有方法

## 3. 注释规范

### 3.1 类注释
```java
/**
 * 类的功能描述
 *
 * @author 作者名
 * @date 创建日期
 */
```

### 3.2 方法注释
```java
/**
 * 方法的功能描述
 *
 * @param 参数名 参数说明
 * @return 返回值说明
 * @throws 异常类型 异常说明
 */
```

### 3.3 代码注释
- 使用//进行单行注释
- 注释应该说明代码的"为什么"而不是"是什么"
- 删除注释掉的代码

### 3.4 DDD相关注释规范
- 领域模型类必须包含详细的业务说明
- 值对象需要说明不变性规则
- 聚合根需要说明聚合边界
- 领域服务需要说明业务场景
- 应用服务需要说明用例流程
- 注释中使用统一语言

## 4. 异常处理

### 4.1 基本原则
- 不要捕获Exception，应该捕获具体的异常
- 不要忽略异常，至少要记录日志
- 使用finally块释放资源，或使用try-with-resources语句

### 4.2 自定义异常
- 继承自合适的异常基类
- 提供有意义的错误信息
- 保留原始异常的堆栈信息
- DDD中的异常分类：
  - 领域异常：DomainException
  - 应用异常：ApplicationException
  - 基础设施异常：InfrastructureException

## 5. 日志规范

### 5.1 日志级别
- ERROR：系统无法正常运行的错误
- WARN：潜在的问题警告
- INFO：重要的业务操作信息
- DEBUG：调试信息
- TRACE：最详细的调试信息

### 5.2 日志内容
- 包含足够的上下文信息
- 敏感信息不应该输出到日志
- 使用占位符而不是字符串拼接
- DDD相关日志规范：
  - 记录领域事件
  - 记录状态变更
  - 记录重要决策
  - 使用统一语言

## 6. 单元测试

### 6.1 测试命名
- 类名：被测试类名 + Test
- 方法名：test + 被测试方法名 + 测试场景
- DDD测试规范：
  - 领域模型测试：关注业务规则
  - 应用服务测试：关注用例流程
  - 集成测试：关注协作

### 6.2 测试原则
- 一个测试方法只测试一个场景
- 遵循AAA模式：Arrange（准备）、Act（执行）、Assert（断言）
- 测试应该是独立的，不依赖于其他测试
- 避免在测试中使用Thread.sleep()

## 7. 性能优化

### 7.1 基本原则
- 优先保证代码的可读性和可维护性
- 在性能关键点上进行优化
- 使用性能测试工具验证优化效果

### 7.2 常见优化
- 使用StringBuilder而不是String拼接
- 合理使用缓存
- 避免创建不必要的对象
- 使用批量操作代替循环单条处理
- DDD相关优化：
  - 合理设计聚合边界
  - 使用领域事件异步处理
  - 读写分离
  - 合理使用值对象

## 8. 安全规范

### 8.1 基本原则
- 所有的用户输入都要进行验证
- 敏感数据要加密存储
- 使用安全的加密算法
- 避免SQL注入和XSS攻击

### 8.2 密码处理
- 不要在代码中硬编码密码
- 密码要加盐存储
- 使用安全的密码哈希算法

## 9. DDD特定规范

### 9.1 值对象实现
- 必须是不可变的
- 必须实现equals和hashCode
- 使用工厂方法创建实例
- 验证规则在构造时执行
- 计算逻辑在值对象内部

### 9.2 实体实现
- 包含唯一标识
- 状态变更通过方法
- 业务规则在实体内部
- 不暴露内部属性

### 9.3 聚合实现
- 通过聚合根访问
- 确保一致性边界
- 异步更新其他聚合
- 使用领域事件通信

### 9.4 仓储实现
- 只依赖领域模型
- 返回充血的领域对象
- 工作单元模式
- 乐观锁控制并发

### 9.5 领域服务实现
- 无状态
- 依赖倒置
- 表达领域概念
- 处理多个聚合

### 9.6 应用服务实现
- 事务边界
- 权限控制
- 参数验证
- 结果转换

### 9.7 防腐层实现
- 转换外部模型
- 处理外部依赖
- 隔离变化
- 适配接口 