<?xml version="1.0"?>
<!DOCTYPE module PUBLIC
    "-//Checkstyle//DTD Checkstyle Configuration 1.3//EN"
    "https://checkstyle.org/dtds/configuration_1_3.dtd">

<!--
  领域模型代码检查规则
  防止技术属性（时间戳等）进入领域对象
-->
<module name="Checker">
    <property name="charset" value="UTF-8"/>
    <property name="severity" value="error"/>
    <property name="fileExtensions" value="java"/>

    <!-- 检查领域包中的类 -->
    <module name="TreeWalker">
        
        <!-- 禁止在领域实体中使用时间相关属性 -->
        <module name="Regexp">
            <property name="format" value="(LocalDateTime|Date|Instant|ZonedDateTime|OffsetDateTime)\s+(createdAt|updatedAt|created|updated|createTime|updateTime)"/>
            <property name="illegalPattern" value="true"/>
            <property name="message" value="领域对象不允许包含创建时间或修改时间属性"/>
            <property name="ignoreComments" value="true"/>
        </module>
        
        <!-- 禁止在领域实体中使用导入时间类 -->
        <module name="IllegalImport">
            <property name="illegalClasses" value="java.time.LocalDateTime, java.util.Date, java.time.Instant, java.time.ZonedDateTime, java.time.OffsetDateTime"/>
            <property name="regexp" value="true"/>
            <property name="id" value="NoTimeClassesInDomain"/>
        </module>
        
        <!-- 针对领域包的特定规则 -->
        <module name="SuppressionFilter">
            <property name="file" value="checkstyle-suppressions.xml"/>
        </module>
        
    </module>

    <!-- 文件过滤器 - 只检查领域包 -->
    <module name="BeforeExecutionExclusionFileFilter">
        <property name="fileNamePattern" value=".*(infrastructure|application|api|service)/.*"/>
    </module>
    
    <!-- 强制领域包结构 -->
    <module name="TreeWalker">
        <module name="PackageDeclaration"/>
        
        <!-- 领域实体必须放在正确的包中 -->
        <module name="Regexp">
            <property name="format" value="package\s+com\.ai\.master\.(\w+)\.domain\.entity"/>
            <property name="message" value="领域实体必须放在 {aggregate}.domain.entity 包中"/>
            <property name="illegalPattern" value="false"/>
        </module>
    </module>
</module>